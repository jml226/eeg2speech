# EEG에서 음성 생성 파이프라인 설계

## 개요

이 문서는 EEG 데이터에서 음성을 생성하는 파이프라인의 설계를 설명합니다. 이 파이프라인은 Perceptogram 아키텍처에서 영감을 받았으며, CLAP(Contrastive Language-Audio Pretraining), Whisper, AudioLDM2와 같은 최신 오디오 모델을 활용합니다.

## 데이터셋

Inner Speech 데이터셋은 10명의 참가자로부터 수집된 136채널 EEG 데이터를 포함하고 있습니다. 이 데이터셋은 내부 음성 명령("Arriba/Up", "Abajo/Down", "Derecha/Right", "Izquierda/Left")에 대한 뇌 활동을 기록했습니다.

## 파이프라인 구조

EEG에서 음성 생성 파이프라인은 다음과 같은 주요 구성 요소로 이루어집니다:

### 1. 데이터 전처리

- EEG 데이터 로드 및 필터링
- 시간 윈도우 선택 (내부 음성 명령이 발생한 구간)
- 채널 선택 및 노이즈 제거
- 데이터 정규화 및 증강

### 2. EEG 인코더 (EEG → 잠재 표현)

Perceptogram의 이중 경로 접근 방식을 채택하여 두 가지 인코더를 사용합니다:

#### 2.1. VAE 인코더
- EEG 데이터를 잠재 공간으로 인코딩
- 변분 오토인코더 구조 사용
- 목적: 음성 특성의 구조적 표현 학습

#### 2.2. CLAP 기반 대조적 인코더
- EEG 데이터와 오디오 데이터 간의 대조적 학습
- CLAP(Contrastive Language-Audio Pretraining) 구조 활용
- 목적: EEG와 오디오 간의 의미적 매핑 학습

### 3. 잠재 표현에서 오디오 생성

두 인코더의 출력을 결합하여 오디오 생성 모델의 입력으로 사용합니다:

#### 3.1. Whisper 기반 오디오 생성기
- 잠재 표현에서 음성 특성 추출
- Whisper 모델의 디코더 부분 활용
- 목적: 음성 이해 및 명확성 향상

#### 3.2. AudioLDM2 기반 오디오 생성기
- 잠재 표현에서 고품질 오디오 생성
- 잠재 확산 모델 사용
- 목적: 자연스럽고 고품질의 음성 합성

### 4. 학습 및 평가

- 혼합 손실 함수: 대조적 손실 + KL 발산 손실 + 재구성 손실
- 학습률 스케줄러 및 조기 종료 전략
- 교차 검증을 통한 모델 평가
- 객관적 메트릭: STOI, PESQ, WER
- 주관적 평가: MOS(Mean Opinion Score)

## 파이프라인 흐름도

```
                                  ┌─────────────────┐
                                  │                 │
                                  │   EEG 데이터    │
                                  │                 │
                                  └────────┬────────┘
                                           │
                                           ▼
                                  ┌─────────────────┐
                                  │                 │
                                  │  데이터 전처리  │
                                  │                 │
                                  └────────┬────────┘
                                           │
                         ┌─────────────────┴─────────────────┐
                         │                                   │
                         ▼                                   ▼
               ┌─────────────────┐                 ┌─────────────────┐
               │                 │                 │                 │
               │   VAE 인코더    │                 │  CLAP 인코더    │
               │                 │                 │                 │
               └────────┬────────┘                 └────────┬────────┘
                        │                                   │
                        ▼                                   ▼
               ┌─────────────────┐                 ┌─────────────────┐
               │                 │                 │                 │
               │  VAE 잠재 표현  │                 │ CLAP 잠재 표현  │
               │                 │                 │                 │
               └────────┬────────┘                 └────────┬────────┘
                        │                                   │
                        └─────────────────┬─────────────────┘
                                          │
                                          ▼
                                 ┌─────────────────┐
                                 │                 │
                                 │  결합된 표현    │
                                 │                 │
                                 └────────┬────────┘
                                          │
                        ┌─────────────────┴─────────────────┐
                        │                                   │
                        ▼                                   ▼
              ┌─────────────────┐                 ┌─────────────────┐
              │                 │                 │                 │
              │ Whisper 디코더  │                 │ AudioLDM2 생성기│
              │                 │                 │                 │
              └────────┬────────┘                 └────────┬────────┘
                       │                                   │
                       ▼                                   ▼
              ┌─────────────────┐                 ┌─────────────────┐
              │                 │                 │                 │
              │  음성 특성      │                 │  고품질 오디오  │
              │                 │                 │                 │
              └────────┬────────┘                 └────────┬────────┘
                       │                                   │
                       └─────────────────┬─────────────────┘
                                         │
                                         ▼
                                ┌─────────────────┐
                                │                 │
                                │  최종 음성 출력 │
                                │                 │
                                └─────────────────┘
```

## 학습 전략

1. **단계적 학습**:
   - 먼저 각 인코더를 개별적으로 사전 학습
   - 오디오 생성 모델을 별도로 학습
   - 전체 파이프라인을 미세 조정

2. **데이터 증강**:
   - EEG 데이터: 시간 이동, 노이즈 추가, 채널 마스킹
   - 오디오 데이터: 피치 변경, 속도 변경, 배경 노이즈 추가

3. **정규화 기법**:
   - 드롭아웃
   - 배치 정규화
   - 가중치 감쇠

## 구현 계획

1. 데이터 전처리 모듈 구현
2. EEG 인코더 모델 구현 (VAE 및 CLAP 기반)
3. 오디오 생성 모델 구현 (Whisper 및 AudioLDM2 기반)
4. 학습 및 평가 코드 구현
5. 전체 파이프라인 통합 및 테스트

## 기술적 고려사항

1. **계산 효율성**:
   - 그래디언트 체크포인팅
   - 혼합 정밀도 학습
   - 모델 양자화

2. **모델 크기**:
   - 지식 증류를 통한 모델 경량화
   - 프루닝 및 양자화

3. **일반화 능력**:
   - 참가자 간 전이 학습
   - 도메인 적응 기법

## 결론

이 파이프라인은 EEG 데이터에서 음성을 생성하는 혁신적인 접근 방식을 제안합니다. Perceptogram 아키텍처의 이중 경로 접근 방식과 최신 오디오 모델(CLAP, Whisper, AudioLDM2)을 결합하여 내부 음성 명령을 외부 음성으로 변환하는 강력한 시스템을 구축합니다.
